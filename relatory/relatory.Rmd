---
title: "RegressÃ£o linear na prÃ¡tica"
output:
  html_document:
    df_print: paged
---

```{r warning=FALSE, echo=FALSE}
library(tidyverse)
library(broom)
library(modelr)
source(here::here("code/lib.R"))
theme_set(theme_bw())

knitr::opts_chunk$set(tidy = FALSE,
                      fig.width = 6,
                      fig.height = 5)

paleta = c("#404E4D",
           "#92DCE5",
           "#938BA1",
           "#2D3142",
           "#F4743B")
```

## Dados da CAPES sobre avaliaÃ§Ã£o da pÃ³s-graduaÃ§Ã£o

A CAPES Ã© um Ã³rgÃ£o do MEC que tem a atribuiÃ§Ã£o de acompanhar a pÃ³s-graduaÃ§Ã£o na universidade brasileira. Uma das formas que ela encontrou de fazer isso e pela qual ela Ã© bastante criticada Ã© atravÃ©s de uma avaliaÃ§Ã£o quantitativa a cada x anos (era 3, mudou para 4). 

Usaremos dados da penÃºltima avaliaÃ§Ã£o da CAPES: 

```{r}
cacc_tudo = read_projectdata()

glimpse(cacc_tudo)
```

### ProduÃ§Ã£o e produtividade de artigos

Uma das maneiras de avaliar a produÃ§Ã£o dos docentes que a CAPES utiliza Ã© quantificando a produÃ§Ã£o de artigos pelos docentes. Os artigos sÃ£o categorizados em extratos ordenados (A1 Ã© o mais alto), e separados entre artigos em conferÃªncias e periÃ³dicos. Usaremos para esse lab a produÃ§Ã£o em periÃ³dicos avaliados com A1, A2 e B1. 

```{r}
cacc = cacc_tudo %>%
  transmute(
    docentes = `Docentes permanentes`,
    producao = (periodicos_A1 + periodicos_A2 + periodicos_B1),
    produtividade = producao / docentes,
    mestrados = Dissertacoes,
    doutorados = Teses,
    tem_doutorado = tolower(`Tem doutorado`) == "sim",
    mestrados_pprof = mestrados / docentes,
    doutorados_pprof = doutorados / docentes
  )

cacc_md = cacc %>% 
  filter(tem_doutorado)
```


### EDA

```{r}
skimr::skim(cacc)
```


```{r}
cacc %>% 
  ggplot(aes(x = docentes)) + 
  geom_histogram(bins = 15, fill = paleta[1])

cacc %>% 
  ggplot(aes(x = producao)) + 
  geom_histogram(bins = 15, fill = paleta[2])

cacc %>% 
  ggplot(aes(x = produtividade)) + 
  geom_histogram(bins = 15, fill = paleta[3])
```

Se quisermos modelar o efeito do tamanho do programa em termos de docentes (permanentes) na quantidade de artigos publicados, podemos usar regressÃ£o. 

*Importante*: sempre queremos ver os dados antes de fazermos qualquer modelo ou sumÃ¡rio: 

```{r}
cacc %>% 
  ggplot(aes(x = docentes, y = producao)) + 
  geom_point()
```

Parece que existe uma relaÃ§Ã£o. Vamos criar um modelo entÃ£o:

```{r}
modelo1 = lm(producao ~ docentes, data = cacc)

tidy(modelo1, conf.int = TRUE, conf.level = 0.95)
glance(modelo1)
```

Para visualizar o modelo:

```{r}
cacc_augmented = cacc %>% 
  add_predictions(modelo1) 

cacc_augmented %>% 
  ggplot(aes(x = docentes)) + 
  geom_line(aes(y = pred), colour = "brown") + 
  geom_point(aes(y = producao)) + 
  labs(y = "ProduÃ§Ã£o do programa")
```

Se considerarmos que temos apenas uma amostra de todos os programas de pÃ³s em CC no Brasil, o que podemos inferir a partir desse modelo sobre a relaÃ§Ã£o entre nÃºmero de docentes permanentes e produÃ§Ã£o de artigos em programas de pÃ³s? 

Normalmente reportarÃ­amos o resultado da seguinte maneira, substituindo VarIndepX e todos os x's e y's pelos nomes e valores de fato:

> RegressÃ£o mÃºltipla foi utilizada para analisar se VarIndep1 e VarIndep2 tem uma associaÃ§Ã£o significativa com VarDep. Os resultados da regressÃ£o indicam que um modelo com os 2 preditores no formato VarDep = XXX.VarIndep1 + YYY.VarIndep2 explicam XX,XX% da variÃ¢ncia da variÃ¡vel de resposta (R2 = XX,XX). VarIndep1, medida como/em [unidade ou o que Ã© o 0 e o que Ã© 1] tem uma relaÃ§Ã£o significativa com o erro (b = [yy,yy; zz,zz], IC com 95%), assim como VarIndep2 medida como [unidade ou o que Ã© o 0 e o que Ã© 1] (b = [yy,yy; zz,zz], IC com 95%). O aumento de 1 unidade de VarIndep1 produz uma mudanÃ§a de xxx em VarDep, enquanto um aumento...

Produza aqui a sua versÃ£o desse texto, portanto:

-----

A regressÃ£o linear simples foi utilizada para analisar se o nÃºmero de docentes permanentes tem uma associaÃ§Ã£o significativa com a produÃ§Ã£o de artigos. Os resultados da regressÃ£o indicam que o modelo no formato ProduÃ§Ã£o = -41.3 + 4.81 * Docentes explica 81.5% da variÃ¢ncia na produÃ§Ã£o de artigos (RÂ² = 0.815). O nÃºmero de docentes permanentes tem uma relaÃ§Ã£o significativa com a produÃ§Ã£o de artigos (b = 4.81; IC com 95%: [4.27, 5.36]). Um aumento de 1 unidade no nÃºmero de docentes permanentes resulta em um aumento de aproximadamente 4.81 na produÃ§Ã£o de artigos.

-----

Dito isso, o que significa a relaÃ§Ã£o que vocÃª encontrou na prÃ¡tica para entendermos os programas de pÃ³s graduaÃ§Ã£o no Brasil? E algum palpite de por que a relaÃ§Ã£o que encontramos Ã© forte?

-----

A anÃ¡lise dos dados revela uma associaÃ§Ã£o estatisticamente significativa entre o nÃºmero de docentes permanentes e a produÃ§Ã£o cientÃ­fica em programas de pÃ³s-graduaÃ§Ã£o. Especificamente, observa-se que programas com um maior quantitativo de docentes tendem a apresentar um volume superior de publicaÃ§Ãµes em periÃ³dicos qualificados.

Essa relaÃ§Ã£o pode ser explicada pelo papel central que os docentes desempenham na estrutura acadÃªmica: eles sÃ£o os principais responsÃ¡veis pela conduÃ§Ã£o de projetos de pesquisa, pela orientaÃ§Ã£o de discentes e pela articulaÃ§Ã£o de redes de colaboraÃ§Ã£o cientÃ­fica. Assim, um corpo docente mais robusto nÃ£o apenas amplia a capacidade operacional do programa, mas tambÃ©m potencializa a geraÃ§Ã£o de conhecimento novo e sua divulgaÃ§Ã£o por meio de publicaÃ§Ãµes cientÃ­ficas.

-----

## Mais fatores

```{r}
modelo2 = lm(producao ~ docentes + mestrados_pprof + doutorados_pprof + tem_doutorado, 
             data = cacc_md)

tidy(modelo2, conf.int = TRUE, conf.level = 0.95)
glance(modelo2)
```

E se considerarmos tambÃ©m o nÃºmero de alunos?

```{r}
modelo2 = lm(producao ~ docentes + mestrados + doutorados, data = cacc)

tidy(modelo2, conf.int = TRUE, conf.level = 0.95)
glance(modelo2)
```

Visualizar o modelo com muitas variÃ¡veis independentes fica mais difÃ­cil

```{r}
para_plotar_modelo = cacc %>% 
  data_grid(producao = seq_range(producao, 10), # Crie um vetor de 10 valores no range
            docentes = seq_range(docentes, 4),  
            # mestrados = seq_range(mestrados, 3),
            mestrados = median(mestrados),
            doutorados = seq_range(doutorados, 3)) %>% 
  add_predictions(modelo2)

glimpse(para_plotar_modelo)

```

```{r}
para_plotar_modelo %>% 
  ggplot(aes(x = docentes, y = pred)) + 
  geom_line(aes(group = doutorados, colour = doutorados)) + 
  geom_point(data = cacc, aes(y = producao, colour = doutorados))
```

Considerando agora esses trÃªs fatores, o que podemos dizer sobre como cada um deles se relaciona com a produÃ§Ã£o de um programa de pÃ³s em CC? E sobre o modelo? Ele explica mais que o modelo 1? 

-----

A anÃ¡lise por regressÃ£o mÃºltipla indica que o nÃºmero de docentes permanentes, de dissertaÃ§Ãµes de mestrado e de teses de doutorado estÃ¡ significativamente associado Ã  produÃ§Ã£o de artigos nos programas de pÃ³s-graduaÃ§Ã£o. O modelo, expresso por:
ProduÃ§Ã£o = -14,4 + 3,50 * Docentes - 0,19 * Mestrados + 1,00 * Doutorados,
apresenta um coeficiente de determinaÃ§Ã£o elevado (RÂ² = 0,871), o que demonstra que aproximadamente 87% da variabilidade na produÃ§Ã£o de artigos pode ser explicada por essas trÃªs variÃ¡veis.

Especificamente, o nÃºmero de docentes e de doutorados possui efeito positivo e estatisticamente significativo sobre a produÃ§Ã£o, sugerindo que programas com mais professores e maior formaÃ§Ã£o de doutores tendem a apresentar maior volume de publicaÃ§Ãµes cientÃ­ficas. Por outro lado, o nÃºmero de dissertaÃ§Ãµes de mestrado mostrou uma associaÃ§Ã£o negativa e tambÃ©m significativa, embora com menor magnitude, o que pode indicar que programas muito focados em mestrados podem apresentar menor produtividade em publicaÃ§Ãµes de alto impacto, possivelmente devido ao carÃ¡ter mais aplicado ou de menor exigÃªncia em termos de produÃ§Ã£o cientÃ­fica do mestrado.

Em comparaÃ§Ã£o com o modelo anterior â€” que considerava apenas o nÃºmero de docentes â€”, este modelo mais completo apresenta maior capacidade explicativa. Isso reforÃ§a a ideia de que, alÃ©m do tamanho do corpo docente, a composiÃ§Ã£o e o nÃ­vel de formaÃ§Ã£o discente tambÃ©m sÃ£o determinantes importantes da produÃ§Ã£o cientÃ­fica em programas de pÃ³s-graduaÃ§Ã£o. Assim, polÃ­ticas voltadas Ã  ampliaÃ§Ã£o do quadro de docentes e Ã  consolidaÃ§Ã£o da formaÃ§Ã£o doutoral podem representar estratÃ©gias eficazes para o fortalecimento da produÃ§Ã£o acadÃªmica nacional.

-----


## Agora produtividade 

Diferente de medirmos produÃ§Ã£o (total produzido), Ã© medirmos produtividade (produzido / utilizado). Abaixo focaremos nessa anÃ¡lise. Para isso crie um modelo que investiga como um conjunto de fatores que vocÃª julga que sÃ£o relevantes se relacionam com a produtividade dos programas. Crie um modelo que avalie como _pelo menos 3 fatores_ se relacionam com a produtividade de um programa. Pode reutilizar fatores que jÃ¡ definimos e analizamos para produÃ§Ã£o. Mas cuidado para nÃ£o incluir fatores que sejam funÃ§Ã£o linear de outros jÃ¡ incluÃ­dos (ex: incluir A, B e um tercero C=A+B)

Produza abaixo o modelo e um texto que comente (i) o modelo, tal como os que fizemos antes, e (ii) as implicaÃ§Ãµes - o que aprendemos sobre como funcionam programas de pÃ³s no brasil?.

```{r}
modelo_produtividade = lm(produtividade ~ docentes + mestrados_pprof + doutorados_pprof, data = cacc_md)
summary(modelo_produtividade)
```

```{r}
cacc_md = cacc_md %>% 
  add_predictions(modelo_produtividade, var = "pred_produtividade")
cacc_md %>% 
  ggplot(aes(x = docentes, y = produtividade)) +
  geom_point() +
  geom_line(aes(y = pred_produtividade), color = "purple") +
  labs(y = "Produtividade (Artigos por Docente)", x = "NÃºmero de Docentes Permanentes")
```

```{r}
tidy(modelo_produtividade, conf.int = TRUE)

glance(modelo_produtividade)
```

Foi utilizada uma regressÃ£o linear mÃºltipla para analisar como o nÃºmero de docentes permanentes, o nÃºmero de mestrados por docente e o nÃºmero de doutorados por docente se relacionam com a produtividade dos programas de pÃ³s-graduaÃ§Ã£o, medida em termos de artigos publicados por docente. O modelo foi definido da seguinte maneira:

Produtividade = ğ›½â‚€ + ğ›½â‚ â‹… Docentes + ğ›½â‚‚ â‹… Mestrados por Docente + ğ›½â‚ƒ â‹… Doutorados por Docente

Os resultados da regressÃ£o indicam que o modelo estimado:

Produtividade = 2,44 + 0,006 â‹… Docentes + 0,021 â‹… Mestrados por Docente + 0,670 â‹… Doutorados por Docente

foi capaz de explicar aproximadamente 28,5% da variÃ¢ncia observada na produtividade (RÂ² = 0,285). Esse nÃ­vel de explicaÃ§Ã£o indica que uma parte relevante da variaÃ§Ã£o na produtividade entre os programas pode ser prevista com base nesses trÃªs fatores, embora ainda haja outros elementos nÃ£o incluÃ­dos no modelo que contribuem para a variaÃ§Ã£o total.

A anÃ¡lise individual dos coeficientes revelou que apenas a variÃ¡vel â€œDoutorados por Docenteâ€ apresentou significÃ¢ncia estatÃ­stica ao nÃ­vel de 5% (p = 0,0175). Com coeficiente estimado em 0,670, isso indica que, para cada aumento unitÃ¡rio na proporÃ§Ã£o de doutorados por docente, a produtividade tende a aumentar, em mÃ©dia, em 0,67 artigos por docente. Esse resultado sugere que a formaÃ§Ã£o de doutorandos estÃ¡ diretamente associada Ã  maior produtividade cientÃ­fica, possivelmente refletindo a complexidade e o rigor dos projetos de pesquisa em nÃ­vel de doutorado, que costumam gerar maior nÃºmero de publicaÃ§Ãµes.

As outras duas variÃ¡veis â€” nÃºmero de docentes permanentes (ğ›½â‚ = 0,006; p = 0,707) e mestrados por docente (ğ›½â‚‚ = 0,021; p = 0,841) â€” nÃ£o apresentaram significÃ¢ncia estatÃ­stica, embora ambas tenham coeficientes positivos. Isso indica que, com os dados disponÃ­veis, nÃ£o hÃ¡ evidÃªncia estatÃ­stica suficiente para afirmar que essas variÃ¡veis estÃ£o relacionadas de forma consistente com a produtividade. Ainda assim, a direÃ§Ã£o positiva dos coeficientes sugere uma possÃ­vel tendÃªncia de contribuiÃ§Ã£o, que poderia ser mais bem compreendida com uma amostra maior ou com a inclusÃ£o de outros fatores explicativos (como Ã¡rea de pesquisa, investimentos, tempo de existÃªncia do programa, entre outros).

Esses achados indicam que programas que formam mais doutorandos por docente tendem a ser mais produtivos em termos de publicaÃ§Ãµes. Isso reforÃ§a a importÃ¢ncia da formaÃ§Ã£o doutoral como um eixo estratÃ©gico para o fortalecimento da pesquisa cientÃ­fica nos programas de pÃ³s-graduaÃ§Ã£o. Embora o nÃºmero de docentes e a formaÃ§Ã£o de mestres nÃ£o tenham se mostrado estatisticamente significativos neste modelo especÃ­fico, seus efeitos nÃ£o devem ser descartados â€” eles podem atuar de forma indireta ou complementar na dinÃ¢mica da produtividade acadÃªmica.

Em resumo, os resultados ressaltam a relevÃ¢ncia de polÃ­ticas voltadas ao fortalecimento da formaÃ§Ã£o de doutores e ao aumento da capacidade de orientaÃ§Ã£o dos docentes permanentes, como estratÃ©gias promissoras para o aprimoramento da produÃ§Ã£o cientÃ­fica dos programas de pÃ³s-graduaÃ§Ã£o no Brasil.